<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>每周计划</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #0a0a0a;
      color: #f0f0f0;
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
      background-image: radial-gradient(circle at 15% 50%, rgba(30, 30, 60, 0.1) 0%, transparent 55%), 
                        radial-gradient(circle at 85% 30%, rgba(40, 40, 80, 0.1) 0%, transparent 55%);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #333;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #4a9eff;
      text-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
    }

    .current-info {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .info-item {
      background: rgba(30, 30, 40, 0.7);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      border: 1px solid #333;
    }

    .schedule-container {
      background: rgba(20, 20, 30, 0.7);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid #333;
    }

    .schedule-item {
      padding: 15px;
      margin: 12px 0;
      border-radius: 8px;
      background: rgba(40, 40, 60, 0.5);
      border-left: 4px solid #4a9eff;
      transition: all 0.3s ease;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .schedule-item:hover {
      transform: translateX(5px);
      background: rgba(50, 50, 70, 0.7);
    }

    .current-schedule {
      background: rgba(74, 158, 255, 0.15);
      border-left: 4px solid #ffcc00;
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
      transform: scale(1.02);
      animation: pulse 2s infinite;
    }

    .day {
      font-weight: bold;
      color: #4a9eff;
      min-width: 80px;
    }

    .time {
      color: #aaa;
      min-width: 160px;
    }

    .content {
      flex: 1;
      color: #e0e0e0;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.2rem;
      color: #4a9eff;
    }

    .error {
      text-align: center;
      padding: 40px;
      color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
      border-radius: 8px;
      margin: 20px 0;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      color: #666;
      font-size: 0.9rem;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(255, 204, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0); }
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .schedule-item {
        flex-direction: column;
        gap: 5px;
      }
      
      .day, .time {
        min-width: auto;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>每周计划</h1>
      <div class="current-info">
        <div class="info-item" id="current-date">日期: 加载中...</div>
        <div class="info-item" id="current-time">时间: 加载中...</div>
        <div class="info-item" id="current-day">星期: 加载中...</div>
      </div>
    </header>

    <main>
      <div class="schedule-container" id="schedule-container">
        <div class="loading">正在加载计划数据...</div>
      </div>
    </main>

    <footer>
      <p>计划数据每周更新 | 当前高亮显示正在进行中的活动</p>
    </footer>
  </div>

  <script>
    // 更新当前日期和时间
    function updateDateTime() {
      const now = new Date();
      const dateElement = document.getElementById('current-date');
      const timeElement = document.getElementById('current-time');
      const dayElement = document.getElementById('current-day');
      
      // 更新日期
      const dateString = now.toLocaleDateString('zh-CN', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      dateElement.textContent = `日期: ${dateString}`;
      
      // 更新时间
      const timeString = now.toLocaleTimeString('zh-CN', { 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit' 
      });
      timeElement.textContent = `时间: ${timeString}`;
      
      // 更新星期
      const dayString = now.toLocaleDateString('zh-CN', { weekday: 'long' });
      dayElement.textContent = `星期: ${dayString}`;
    }

    // 将时间字符串转换为分钟数（便于比较）
    function timeToMinutes(timeStr) {
      if (!timeStr || !timeStr.includes(':')) return -1;
      
      const [hours, minutes] = timeStr.split(':').map(Number);
      return hours * 60 + minutes;
    }

    // 解析CSV行，处理引号包裹的情况
    function parseCSVLine(line) {
      // 移除行首尾的引号
      const cleanLine = line.replace(/^"|"$/g, '');
      
      // 分割字段，但要注意内容中可能包含逗号
      const parts = [];
      let currentPart = '';
      let inQuotes = false;
      
      for (let i = 0; i < cleanLine.length; i++) {
        const char = cleanLine[i];
        
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          parts.push(currentPart.trim());
          currentPart = '';
        } else {
          currentPart += char;
        }
      }
      
      // 添加最后一个部分
      parts.push(currentPart.trim());
      
      return parts;
    }

    // 初始化页面
    document.addEventListener('DOMContentLoaded', function() {
      // 立即更新一次时间
      updateDateTime();
      
      // 每秒更新时间
      setInterval(updateDateTime, 1000);
      
      // 加载CSV数据
      fetch('https://allen-china.github.io/jihuaxianshi-xuesheng-week/401/week.csv')
        .then(response => {
          if (!response.ok) {
            throw new Error('网络响应不正常');
          }
          return response.text();
        })
        .then(data => {
          const container = document.getElementById('schedule-container');
          container.innerHTML = '';
          
          const lines = data.split('\n').filter(line => line.trim() !== '');
          const now = new Date();
          const currentDay = now.toLocaleDateString('zh-CN', { weekday: 'long' });
          const currentTime = now.toLocaleTimeString('zh-CN', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: false
          });
          
          const currentMinutes = timeToMinutes(currentTime);
          let hasCurrentItem = false;
          
          lines.forEach(line => {
            const parts = parseCSVLine(line);
            if (parts.length < 3) return;
            
            const day = parts[0];
            const timeRange = parts[1];
            const content = parts[2];
            
            if (!day || !timeRange) return;
            
            const scheduleItem = document.createElement('div');
            scheduleItem.className = 'schedule-item';
            
            // 检查是否是当前时间段
            if (day.includes(currentDay) && timeRange.includes('-')) {
              const [startTime, endTime] = timeRange.split('-');
              const startMinutes = timeToMinutes(startTime);
              const endMinutes = timeToMinutes(endTime);
              
              if (currentMinutes >= startMinutes && currentMinutes <= endMinutes) {
                scheduleItem.classList.add('current-schedule');
                hasCurrentItem = true;
              }
            }
            
            scheduleItem.innerHTML = `
              <div class="day">${day}</div>
              <div class="time">${timeRange}</div>
              <div class="content">${content}</div>
            `;
            
            container.appendChild(scheduleItem);
          });
          
          // 如果没有当前项目，显示提示
          if (!hasCurrentItem) {
            const noCurrentItem = document.createElement('div');
            noCurrentItem.className = 'schedule-item';
            noCurrentItem.innerHTML = `
              <div class="content" style="text-align: center; width: 100%;">
                当前时间段没有安排活动
              </div>
            `;
            container.appendChild(noCurrentItem);
          }
        })
        .catch(error => {
          console.error('获取CSV数据时出错:', error);
          const container = document.getElementById('schedule-container');
          container.innerHTML = `
            <div class="error">
              <h3>加载计划数据失败</h3>
              <p>请检查网络连接或稍后再试</p>
              <p>错误详情: ${error.message}</p>
            </div>
          `;
        });
    });
  </script>
</body>

</html>